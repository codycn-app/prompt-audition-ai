<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompt Audition AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@600&family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
      // Definitive fix for black screen/flicker issue.
      // This script runs BEFORE React and applies the theme instantly.
      (function() {
        try {
          const theme = localStorage.getItem('theme');
          if (theme === 'light') {
            document.documentElement.classList.add('light');
          } else {
            // Default to dark if no theme is set or it's invalid.
            document.documentElement.classList.add('dark');
          }
        } catch (e) {
          // Fallback to dark theme in case of any error.
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    <script>
      // FINAL FIX: Ultimate Supabase session recovery script.
      // This script addresses a subtle bug where a structurally valid, but logically incomplete,
      // session in localStorage causes the Supabase client to hang indefinitely on initialization.
      (function() {
        try {
          var keysToPotentiallyRemove = [];
          var mainSessionKey = null;

          // 1. Find the main session key and gather all other potential Supabase keys.
          for (var i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i);
            if (key) {
               if (key.startsWith('sb-') && key.endsWith('-auth-token')) {
                mainSessionKey = key;
              }
              if (key.startsWith('sb-') || key.startsWith('supabase.auth.token')) {
                keysToPotentiallyRemove.push(key);
              }
            }
          }

          // 2. If no potential keys exist, the slate is clean. Nothing to do.
          if (keysToPotentiallyRemove.length === 0) {
            return;
          }
          
          var isSessionHealthy = false;

          // 3. If a main session key was found, validate it aggressively.
          if (mainSessionKey) {
            var value = localStorage.getItem(mainSessionKey);
            if (value) {
              try {
                var parsed = JSON.parse(value);
                // AGGRESSIVE VALIDATION: A healthy session must have all these properties
                // with the correct types and non-empty values. This catches "valid-but-poisonous" data.
                if (
                  parsed &&
                  typeof parsed.access_token === 'string' && parsed.access_token.length > 0 &&
                  typeof parsed.refresh_token === 'string' && parsed.refresh_token.length > 0 &&
                  typeof parsed.user === 'object' && parsed.user !== null &&
                  typeof parsed.user.id === 'string' && parsed.user.id.length > 0 &&
                  parsed.user.aud === 'authenticated'
                ) {
                  isSessionHealthy = true;
                }
              } catch (e) {
                // JSON parsing failed. This is definitive corruption. isSessionHealthy remains false.
              }
            }
          }

          // 4. If the session is NOT healthy, perform a full cleanup.
          if (!isSessionHealthy) {
            console.warn('Supabase session is invalid, incomplete, or corrupted. Cleaning up localStorage to prevent app hang.');
            keysToPotentiallyRemove.forEach(function(key) {
              localStorage.removeItem(key);
            });
            console.log('Supabase localStorage cleared. App will now load correctly.');
          }

        } catch (e) {
          // If the recovery script itself fails, log it, but do not crash the page.
          console.error('Critical error in Supabase recovery script:', e);
        }
      })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              'sans': ['"Be Vietnam Pro"', 'sans-serif'],
              'oxanium': ['"Oxanium"', 'sans-serif'],
            },
            colors: {
              'cyber-black': '#0D0D0D',
              'cyber-surface': '#1A1A1A',
              'cyber-pink': '#FF00E6',
              'cyber-cyan': '#00FFFF',
              'cyber-on-surface': '#E0E0E0',
              'cyber-on-surface-secondary': '#A0A0A0',
              'rank-admin': '#FF4141',
              'rank-master': '#FFD700', // Gold
              'rank-silver': '#C0C0C0', // Silver
              'rank-bronze': '#CD7F32', // Bronze
              'rank-expert': '#DA70D6',
              'rank-advanced': '#87CEFA',
            },
            boxShadow: {
              'cyber-glow': '0 0 15px rgba(255, 0, 230, 0.5), 0 0 5px rgba(0, 255, 255, 0.4)',
              'cyber-glow-lg': '0 0 25px rgba(255, 0, 230, 0.6), 0 0 10px rgba(0, 255, 255, 0.5)',
            },
            keyframes: {
              'fade-in-scale': {
                '0%': { opacity: '0', transform: 'scale(0.95)' },
                '100%': { opacity: '1', transform: 'scale(1)' },
              },
              'background-pan': {
                '0%': { backgroundPosition: '0% center' },
                '100%': { backgroundPosition: '-200% center' },
              },
              'toast-in-out': {
                '0%': { transform: 'translateY(100%)', opacity: '0' },
                '20%': { transform: 'translateY(0)', opacity: '1' },
                '80%': { transform: 'translateY(0)', opacity: '1' },
                '100%': { transform: 'translateY(100%)', opacity: '0' },
              },
              'text-glow': {
                '0%': { textShadow: '0 0 4px currentColor' },
                '100%': { textShadow: '0 0 10px currentColor' },
              },
              'icon-glow': {
                '0%, 100%': { filter: 'drop-shadow(0 0 2px rgba(255, 215, 0, 0.7))' },
                '50%': { filter: 'drop-shadow(0 0 5px rgba(255, 215, 0, 1))' },
              },
            },
            animation: {
              'fade-in-scale': 'fade-in-scale 0.3s ease-in-out',
              'background-pan': 'background-pan 3s linear infinite',
              'toast-in-out': 'toast-in-out 3s ease-in-out forwards',
              'text-glow': 'text-glow 1.5s ease-in-out infinite alternate',
              'icon-glow': 'icon-glow 2s ease-in-out infinite',
            }
          },
        },
      }
    </script>
    <style>
      body {
        background-color: #0D0D0D;
        background-image:
          linear-gradient(rgba(255, 0, 230, 0.05) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255, 0, 230, 0.05) 1px, transparent 1px);
        background-size: 40px 40px;
      }
      /* Custom Scrollbar Styles */
      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #1A1A1A; /* cyber-surface */
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-image: linear-gradient(to bottom, #FF00E6, #00FFFF); /* cyber-pink to cyber-cyan */
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        opacity: 0.8;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^0.15.0",
    "@supabase/supabase-js": "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"
  }
}
</script>
</head>
  <body class="bg-cyber-black font-sans">
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>